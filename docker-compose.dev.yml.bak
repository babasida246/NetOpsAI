# Development overrides
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  gateway-api:
    build:
      target: builder
    command: sh -c "pnpm install && pnpm --filter gateway-api dev"
    volumes:
      - .:/app
      - /app/node_modules
      - /app/packages/domain/node_modules
      - /app/packages/contracts/node_modules
      - /app/packages/application/node_modules
      - /app/packages/config/node_modules
      - /app/packages/infra-postgres/node_modules
      - /app/packages/infra-redis/node_modules
      - /app/packages/observability/node_modules
      - /app/packages/providers/node_modules
      - /app/packages/security/node_modules
      - /app/packages/tools/node_modules
      - /app/apps/gateway-api/node_modules
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    ports:
      - "3000:3000"
      - "9229:9229"  # Node.js debugger

  gateway-mcp:
    build:
      target: builder
    command: sh -c "pnpm install && pnpm --filter gateway-mcp dev"
    volumes:
      - .:/app
      - /app/node_modules
      - /app/packages/domain/node_modules
      - /app/packages/contracts/node_modules
      - /app/packages/application/node_modules
      - /app/packages/config/node_modules
      - /app/packages/observability/node_modules
      - /app/packages/providers/node_modules
      - /app/packages/tools/node_modules
      - /app/apps/gateway-mcp/node_modules
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    ports:
      - "3001:3001"
      - "9230:9229"  # Node.js debugger

  postgres:
    ports:
      - "5432:5432"
    environment:
      POSTGRES_PASSWORD: postgres_dev
    volumes:
      - postgres_dev_data:/var/lib/postgresql/data

  redis:
    ports:
      - "6379:6379"
    environment:
      REDIS_PASSWORD: redis_dev

  web-ui:
    build:
      context: .
      dockerfile: apps/web-ui/Dockerfile.dev
    container_name: hospital-gateway-web-ui-dev
    depends_on:
      - gateway-api
    environment:
      NODE_ENV: development
      PORT: 5173
      VITE_API_BASE: http://localhost:3000
    ports:
      - "5173:5173"
    volumes:
      - ./apps/web-ui:/app/apps/web-ui
      - /app/node_modules
      - /app/apps/web-ui/node_modules
    networks:
      - hospital-gateway-network

volumes:
  postgres_dev_data:
    driver: local
